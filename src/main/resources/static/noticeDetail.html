<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notice Detail</title>
</head>
<body>
<h1>Notice Detail</h1>
<div id="noticeDetail">
  <h2 id="title"></h2>
  <p id="content"></p>
  <button id="deleteButton">Delete</button>
</div>

<script>
    // URL에서 id 파라미터를 추출하는 함수
    function getQueryParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    // 게시글 상세 정보를 가져와서 표시하는 함수
    async function fetchNoticeDetail() {
        const noticeId = getQueryParameter('id');
        if (!noticeId) {
            document.getElementById('noticeDetail').innerText = 'Notice ID is missing in the URL';
            return;
        }

        try {
            const response = await fetch(`/notice/${noticeId}`);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const notice = await response.json();

            // 데이터를 HTML 요소에 표시
            document.getElementById('title').innerText = notice.title;
            document.getElementById('content').innerText = notice.content;
        } catch (error) {
            document.getElementById('noticeDetail').innerText = `Failed to fetch notice details: ${error}`;
        }
    }

    // 게시글을 삭제하는 함수
    async function deleteNotice() {
        const noticeId = getQueryParameter('id');
        if (!noticeId) {
            alert('Notice ID is missing in the URL');
            return;
        }

        try {
            const response = await fetch(`/notice/${noticeId}`, {
                method: 'DELETE',
            });

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            alert('Notice deleted successfully');
            window.location.href = '/noticeTest.html'; // 삭제 후 메인 페이지로 리다이렉트
        } catch (error) {
            alert(`Failed to delete notice: ${error}`);
        }
    }

    // 페이지 로드 시 게시글 상세 정보를 가져옴
    window.onload = fetchNoticeDetail;

    // 삭제 버튼 클릭 시 삭제 함수 호출
    document.getElementById('deleteButton').addEventListener('click', deleteNotice);
</script>
</body>
</html>
